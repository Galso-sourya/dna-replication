<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DNA Replication Quiz Game ‚Äì Timed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #020617, #0f172a, #1e293b);
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.14);
      --correct: #22c55e;
      --wrong: #ef4444;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --shadow-soft: 0 24px 80px rgba(15, 23, 42, 0.9);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-image: var(--bg-gradient);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .app-shell {
      max-width: 960px;
      width: 100%;
      background: radial-gradient(circle at top left, #1f2937 0, #020617 45%);
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.45);
      overflow: hidden;
    }

    header {
      padding: 24px 32px 14px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.5), transparent);
    }

    header h1 {
      font-size: 1.8rem;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header h1 .logo {
      display: inline-flex;
      width: 36px;
      height: 36px;
      border-radius: 999px;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
      color: #0f172a;
      background: radial-gradient(circle at 30% 0, #f9fafb, #22d3ee);
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.7);
    }

    .meta-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.85);
      font-size: 0.75rem;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .scoreboard {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.85rem;
    }

    .scoreboard strong { color: var(--accent); }

    .timer {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.85rem;
    }

    .timer span#timerText { font-weight: 600; color: var(--accent); }

    main {
      padding: 24px 32px 28px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .instructions {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .highlight { color: var(--accent); font-weight: 500; }

    .hint {
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hint-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .question-card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 16px 18px 14px;
      margin-bottom: 14px;
      position: relative;
      overflow: hidden;
    }

    .question-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.07), transparent 60%);
      pointer-events: none;
    }

    .q-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .q-number {
      font-weight: 600;
      font-size: 0.95rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .q-tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid rgba(56, 189, 248, 0.7);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .q-text {
      font-size: 0.98rem;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .options {
      margin-top: 6px;
      display: grid;
      gap: 6px;
      position: relative;
      z-index: 1;
    }

    .option-label {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 0.92rem;
      padding: 7px 9px;
      border-radius: 10px;
      cursor: pointer;
      border: 1px solid transparent;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.08s ease;
    }

    .option-label:hover {
      background: rgba(15, 23, 42, 0.9);
      border-color: rgba(148, 163, 184, 0.5);
      transform: translateY(-1px);
    }

    .option-label input {
      margin-top: 2px;
      accent-color: var(--accent);
      cursor: pointer;
    }

    .option-text { flex: 1; }

    .option-label.correct {
      border-color: rgba(34, 197, 94, 0.9);
      background: rgba(22, 163, 74, 0.18);
    }

    .option-label.incorrect {
      border-color: rgba(239, 68, 68, 0.9);
      background: rgba(127, 29, 29, 0.3);
    }

    .option-label.correct.chosen::after {
      content: "‚úî Correct (+1)";
      font-size: 0.75rem;
      margin-left: auto;
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.4);
      padding: 1px 8px;
      border-radius: 999px;
    }

    .option-label.incorrect.chosen::after {
      content: "‚úñ Wrong (‚àí0.25)";
      font-size: 0.75rem;
      margin-left: auto;
      color: #fecaca;
      background: rgba(127, 29, 29, 0.8);
      padding: 1px 8px;
      border-radius: 999px;
    }

    .footer-bar {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid rgba(148, 163, 184, 0.4);
      padding-top: 14px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      border: none;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.92rem;
      border-radius: 999px;
      padding: 8px 16px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, transform 0.08s ease,
                  box-shadow 0.1s ease, border-color 0.1s ease, opacity 0.1s ease;
    }

    button:active { transform: translateY(1px) scale(0.99); box-shadow: none; }

    .btn-primary {
      background: radial-gradient(circle at top left, #38bdf8, #0ea5e9);
      color: #0f172a;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.55);
    }
    .btn-primary:hover { background: radial-gradient(circle at top left, #7dd3fc, #0ea5e9); }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }
    .btn-ghost:hover:not(:disabled) {
      background: rgba(15, 23, 42, 0.9);
      color: var(--accent);
      border-color: rgba(56, 189, 248, 0.7);
    }
    .btn-ghost:disabled { opacity: 0.4; cursor: not-allowed; }

    .score-pill {
      font-size: 0.9rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .score-pill strong { color: var(--accent); }

    .score-pill .tag {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 2px 8px;
      border-radius: 999px;
    }

    .tag-good {
      background: rgba(22, 163, 74, 0.25);
      color: #bbf7d0;
    }
    .tag-ok {
      background: rgba(245, 158, 11, 0.25);
      color: #fef9c3;
    }
    .tag-bad {
      background: rgba(239, 68, 68, 0.25);
      color: #fee2e2;
    }

    .medal-box {
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .game-message {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .game-message strong { color: var(--accent); }

    .answer-key {
      margin-top: 10px;
      font-size: 0.9rem;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      display: none;
    }

    .answer-key h3 {
      font-size: 0.95rem;
      margin-bottom: 8px;
      color: var(--accent);
    }

    .answer-key-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 6px;
    }

    .answer-key-item {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    @media (max-width: 640px) {
      header, main { padding: 18px 16px; }
      header h1 { font-size: 1.4rem; }
      .question-card { padding: 14px 12px; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <h1>
        <span class="logo">DNA</span>
        DNA Replication Quiz Game
      </h1>
      <div class="meta-row">
        <span>Subject: Biology | Topic: DNA Replication | Class: XI / XII</span>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <div class="scoreboard">
            üéØ High Score:&nbsp;<strong id="highScoreText">0 / 10</strong>
            &nbsp;| Attempts: <span id="attemptCount">0</span>
          </div>
          <div class="timer">
            ‚è± Time Left: <span id="timerText">03:00</span>
          </div>
        </div>
      </div>
      <div class="pill" style="margin-top:8px;">
        <span class="pill-dot"></span>
        Game Rules: Timer per quiz ‚Ä¢ +1 correct ‚Ä¢ ‚àí0.25 wrong ‚Ä¢ Answers unlock only after submit.
      </div>
    </header>

    <main>
      <div class="instructions">
        <span>
          Answer all 10 questions, then press
          <span class="highlight">Submit &amp; Score</span> before time runs out.
        </span>
        <span class="hint">
          <span class="hint-dot"></span>
          HOTS (Higher Order Thinking Skills) questions are tagged.
        </span>
      </div>

      <!-- Q1 -->
      <div class="question-card" data-q="1">
        <div class="q-header">
          <span class="q-number">Question 1</span>
        </div>
        <div class="q-text">
          DNA replication is described as "semi-conservative" because:
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q1" value="a" />
            <span class="option-text">a) Both strands of the parent DNA remain together</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q1" value="b" />
            <span class="option-text">b) Only new strands form without using old strands</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q1" value="c" />
            <span class="option-text">c) Each daughter DNA has one parental and one newly synthesized strand</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q1" value="d" />
            <span class="option-text">d) Both daughter DNAs contain only new strands</span>
          </label>
        </div>
      </div>

      <!-- Q2 -->
      <div class="question-card" data-q="2">
        <div class="q-header">
          <span class="q-number">Question 2</span>
        </div>
        <div class="q-text">
          Which enzyme is responsible for unwinding the DNA double helix?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q2" value="a" />
            <span class="option-text">a) DNA ligase</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q2" value="b" />
            <span class="option-text">b) DNA helicase</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q2" value="c" />
            <span class="option-text">c) Primase</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q2" value="d" />
            <span class="option-text">d) DNA polymerase I</span>
          </label>
        </div>
      </div>

      <!-- Q3 -->
      <div class="question-card" data-q="3">
        <div class="q-header">
          <span class="q-number">Question 3</span>
        </div>
        <div class="q-text">
          DNA polymerase can add nucleotides only in the:
        </div>
        <div class="options">
          <label class="option-label" data-correct="true">
            <input type="radio" name="q3" value="a" />
            <span class="option-text">a) 5‚Äô ‚Üí 3‚Äô direction</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="b" />
            <span class="option-text">b) 3‚Äô ‚Üí 5‚Äô direction</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="c" />
            <span class="option-text">c) Both directions</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="d" />
            <span class="option-text">d) Randomly</span>
          </label>
        </div>
      </div>

      <!-- Q4 -->
      <div class="question-card" data-q="4">
        <div class="q-header">
          <span class="q-number">Question 4</span>
        </div>
        <div class="q-text">
          The discontinuous fragments formed on the lagging strand are called:
        </div>
        <div class="options">
          <label class="option-label" data-correct="true">
            <input type="radio" name="q4" value="a" />
            <span class="option-text">a) Okazaki fragments</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q4" value="b" />
            <span class="option-text">b) Replication forks</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q4" value="c" />
            <span class="option-text">c) Nucleosomes</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q4" value="d" />
            <span class="option-text">d) TATA fragments</span>
          </label>
        </div>
      </div>

      <!-- Q5 -->
      <div class="question-card" data-q="5">
        <div class="q-header">
          <span class="q-number">Question 5</span>
        </div>
        <div class="q-text">
          Which enzyme removes RNA primers during DNA replication?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q5" value="a" />
            <span class="option-text">a) DNA polymerase III</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q5" value="b" />
            <span class="option-text">b) DNA ligase</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q5" value="c" />
            <span class="option-text">c) DNA polymerase I</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q5" value="d" />
            <span class="option-text">d) Primase</span>
          </label>
        </div>
      </div>

      <!-- HOTS Q6 -->
      <div class="question-card" data-q="6">
        <div class="q-header">
          <span class="q-number">Question 6</span>
          <span class="q-tag">HOTS</span>
        </div>
        <div class="q-text">
          DNA polymerase III has high accuracy due to its proofreading ability. What would MOST LIKELY happen if this function is lost?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q6" value="a" />
            <span class="option-text">a) Replication will completely stop</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q6" value="b" />
            <span class="option-text">b) Rate of replication increases</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q6" value="c" />
            <span class="option-text">c) Mutation rate will increase significantly</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q6" value="d" />
            <span class="option-text">d) Okazaki fragments will not form</span>
          </label>
        </div>
      </div>

      <!-- HOTS Q7 -->
      <div class="question-card" data-q="7">
        <div class="q-header">
          <span class="q-number">Question 7</span>
          <span class="q-tag">HOTS</span>
        </div>
        <div class="q-text">
          If the amount of adenine in a replicating DNA molecule decreases, which process will be directly affected?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q7" value="a" />
            <span class="option-text">a) Formation of RNA primer</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q7" value="b" />
            <span class="option-text">b) Joining of Okazaki fragments</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q7" value="c" />
            <span class="option-text">c) Complementary pairing on the new strand</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q7" value="d" />
            <span class="option-text">d) Supercoiling of DNA</span>
          </label>
        </div>
      </div>

      <!-- HOTS Q8 -->
      <div class="question-card" data-q="8">
        <div class="q-header">
          <span class="q-number">Question 8</span>
          <span class="q-tag">HOTS</span>
        </div>
        <div class="q-text">
          A scientist inhibits the function of ligase in a cell. Which observation is MOST LIKELY?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q8" value="a" />
            <span class="option-text">a) DNA cannot unwind</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q8" value="b" />
            <span class="option-text">b) RNA primers cannot be formed</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q8" value="c" />
            <span class="option-text">c) Lagging strand fragments remain unjoined</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q8" value="d" />
            <span class="option-text">d) Replication becomes bidirectional</span>
          </label>
        </div>
      </div>

      <!-- HOTS Q9 -->
      <div class="question-card" data-q="9">
        <div class="q-header">
          <span class="q-number">Question 9</span>
          <span class="q-tag">HOTS</span>
        </div>
        <div class="q-text">
          In a cell experiment, DNA replication is occurring but the lagging strand is missing. Which enzyme is MOST LIKELY defective?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q9" value="a" />
            <span class="option-text">a) Helicase</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q9" value="b" />
            <span class="option-text">b) Primase</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q9" value="c" />
            <span class="option-text">c) DNA polymerase I</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q9" value="d" />
            <span class="option-text">d) DNA ligase</span>
          </label>
        </div>
      </div>

      <!-- HOTS Q10 -->
      <div class="question-card" data-q="10">
        <div class="q-header">
          <span class="q-number">Question 10</span>
          <span class="q-tag">HOTS</span>
        </div>
        <div class="q-text">
          A mutation causes an enzyme that can synthesize DNA but cannot remove RNA primers. What error will appear in the new DNA?
        </div>
        <div class="options">
          <label class="option-label">
            <input type="radio" name="q10" value="a" />
            <span class="option-text">a) Unwound DNA strands</span>
          </label>
          <label class="option-label" data-correct="true">
            <input type="radio" name="q10" value="b" />
            <span class="option-text">b) DNA fragments with RNA patches left inside</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q10" value="c" />
            <span class="option-text">c) No formation of replication bubble</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q10" value="d" />
            <span class="option-text">d) Overproduction of Okazaki fragments</span>
          </label>
        </div>
      </div>

      <div class="footer-bar">
        <div class="btn-row">
          <button class="btn-primary" id="submitBtn">
            üß¨ Submit &amp; Score
          </button>
          <button class="btn-ghost" id="resetBtn">
            üîÅ Play Again
          </button>
          <button class="btn-ghost" id="toggleKeyBtn" disabled>
            üìò Show Answer Key
          </button>
        </div>
        <div id="scoreBox" class="score-pill" style="display: none;">
          <span>Your Score:&nbsp;<strong id="scoreText"></strong></span>
          <span class="tag" id="scoreTag"></span>
          <span class="medal-box" id="medalBox"></span>
        </div>
      </div>

      <div class="game-message" id="gameMessage"></div>

      <div id="answerKey" class="answer-key">
        <h3>Answer Key</h3>
        <div class="answer-key-grid">
          <div class="answer-key-item">Q1 ‚Üí c</div>
          <div class="answer-key-item">Q2 ‚Üí b</div>
          <div class="answer-key-item">Q3 ‚Üí a</div>
          <div class="answer-key-item">Q4 ‚Üí a</div>
          <div class="answer-key-item">Q5 ‚Üí c</div>
          <div class="answer-key-item">Q6 ‚Üí c</div>
          <div class="answer-key-item">Q7 ‚Üí c</div>
          <div class="answer-key-item">Q8 ‚Üí c</div>
          <div class="answer-key-item">Q9 ‚Üí b</div>
          <div class="answer-key-item">Q10 ‚Üí b</div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const totalQuestions = 10;

    // ===== TIMER SETTINGS =====
    const QUIZ_TIME_SECONDS = 3 * 60; // 5 minutes (change if you want)
    let timeLeft = QUIZ_TIME_SECONDS;
    let timerInterval = null;

    const submitBtn = document.getElementById("submitBtn");
    const resetBtn = document.getElementById("resetBtn");
    const toggleKeyBtn = document.getElementById("toggleKeyBtn");
    const scoreBox = document.getElementById("scoreBox");
    const scoreText = document.getElementById("scoreText");
    const scoreTag = document.getElementById("scoreTag");
    const medalBox = document.getElementById("medalBox");
    const answerKeyBox = document.getElementById("answerKey");
    const gameMessage = document.getElementById("gameMessage");
    const timerText = document.getElementById("timerText");
    const highScoreText = document.getElementById("highScoreText");
    const attemptCount = document.getElementById("attemptCount");

    let hasSubmittedOnce = false;
    let quizEnded = false;

    // ==== Local storage: high score & attempts ====
    function loadGameStats() {
      try {
        const savedHigh = localStorage.getItem("dnaQuizHighScoreTimed");
        const savedAttempts = localStorage.getItem("dnaQuizAttemptsTimed");
        if (savedHigh !== null) {
          highScoreText.textContent = `${parseFloat(savedHigh).toFixed(2)} / 10`;
        }
        if (savedAttempts !== null) {
          attemptCount.textContent = savedAttempts;
        }
      } catch (e) {
        // localStorage may not be available (ignore)
      }
    }

    function updateGameStats(score) {
      try {
        let currentHigh = parseFloat(localStorage.getItem("dnaQuizHighScoreTimed") || "0");
        let attempts = parseInt(localStorage.getItem("dnaQuizAttemptsTimed") || "0", 10);

        attempts += 1;
        localStorage.setItem("dnaQuizAttemptsTimed", attempts.toString());
        attemptCount.textContent = attempts;

        if (score > currentHigh) {
          localStorage.setItem("dnaQuizHighScoreTimed", score.toString());
          currentHigh = score;
        }

        highScoreText.textContent = `${currentHigh.toFixed(2)} / 10`;
      } catch (e) {
        // ignore if localStorage unavailable
      }
    }

    // ===== TIMER FUNCTIONS =====
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    }

    function updateTimerDisplay() {
      timerText.textContent = formatTime(timeLeft);
      if (timeLeft <= 30) {
        timerText.style.color = "#f97316"; // orange
      } else if (timeLeft <= 60) {
        timerText.style.color = "#facc15"; // yellow
      } else {
        timerText.style.color = "#38bdf8"; // accent
      }
    }

    function startTimer() {
      clearInterval(timerInterval);
      timeLeft = QUIZ_TIME_SECONDS;
      updateTimerDisplay();
      quizEnded = false;

      timerInterval = setInterval(() => {
        if (quizEnded) {
          clearInterval(timerInterval);
          return;
        }
        timeLeft--;
        if (timeLeft <= 0) {
          timeLeft = 0;
          updateTimerDisplay();
          clearInterval(timerInterval);
          if (!quizEnded) {
            gameMessage.textContent = "‚è∞ Time's up! Auto-submitting your quiz...";
            gradeQuiz(true); // auto submit without confirm
          }
        } else {
          updateTimerDisplay();
        }
      }, 1000);
    }

    // ===== QUIZ FUNCTIONS =====
    function clearFeedback() {
      const optionLabels = document.querySelectorAll(".option-label");
      optionLabels.forEach((label) => {
        label.classList.remove("correct", "incorrect", "chosen");
      });
    }

    function disableAllInputs() {
      const inputs = document.querySelectorAll('input[type="radio"]');
      inputs.forEach((input) => (input.disabled = true));
      submitBtn.disabled = true;
    }

    function enableAllInputs() {
      const inputs = document.querySelectorAll('input[type="radio"]');
      inputs.forEach((input) => (input.disabled = false));
      submitBtn.disabled = false;
    }

    // autoSubmit = true when timer ends
    function gradeQuiz(autoSubmit = false) {
      let score = 0;
      let attempted = 0;

      clearFeedback();
      answerKeyBox.style.display = "none";
      gameMessage.textContent = "";

      for (let i = 1; i <= totalQuestions; i++) {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        const card = document.querySelector(`.question-card[data-q="${i}"]`);
        const correctLabel = card.querySelector('.option-label[data-correct="true"]');

        if (!selected) continue;

        attempted++;

        const selectedLabel = selected.closest(".option-label");

        if (selectedLabel === correctLabel) {
          score += 1; // correct
          correctLabel.classList.add("correct", "chosen");
        } else {
          score -= 0.25; // negative marking
          selectedLabel.classList.add("incorrect", "chosen");
          if (correctLabel) {
            correctLabel.classList.add("correct");
          }
        }
      }

      if (attempted < totalQuestions && !autoSubmit) {
        const confirmProceed = confirm(
          `You have answered ${attempted} out of ${totalQuestions} questions.\nDo you still want to submit and end this round?`
        );
        if (!confirmProceed) {
          clearFeedback();
          scoreBox.style.display = "none";
          gameMessage.textContent = "‚úÖ Tip: Answer all questions to maximize your score. Negative marking applies for wrong answers.";
          return;
        }
      }

      // Clamp minimum score to 0 (no negative total)
      if (score < 0) score = 0;

      quizEnded = true;
      clearInterval(timerInterval);
      disableAllInputs();

      hasSubmittedOnce = true;
      toggleKeyBtn.disabled = false; // unlock answer key

      const scoreRounded = parseFloat(score.toFixed(2));
      scoreText.textContent = `${scoreRounded.toFixed(2)} / 10`;

      const percent = (scoreRounded / totalQuestions) * 100;
      scoreTag.classList.remove("tag-good", "tag-ok", "tag-bad");
      medalBox.textContent = "";

      let medalHTML = "";
      if (percent >= 80) {
        scoreTag.textContent = "Excellent";
        scoreTag.classList.add("tag-good");
        medalHTML = "ü•á ‚òÖ‚òÖ‚òÖ Gold Medal";
        gameMessage.innerHTML = "üî• <strong>Outstanding!</strong> You‚Äôve mastered DNA replication. Try again to maintain your gold!";
      } else if (percent >= 50) {
        scoreTag.textContent = "Keep Improving";
        scoreTag.classList.add("tag-ok");
        medalHTML = "ü•à ‚òÖ‚òÖ Silver Medal";
        gameMessage.innerHTML = "üëç <strong>Nice work!</strong> You‚Äôre on the right track. Revise the weak areas and go for gold.";
      } else if (percent >= 30) {
        scoreTag.textContent = "Needs Practice";
        scoreTag.classList.add("tag-bad");
        medalHTML = "ü•â ‚òÖ Bronze Medal";
        gameMessage.innerHTML = "üìö <strong>Keep practicing!</strong> Review the basics and challenge yourself again.";
      } else {
        scoreTag.textContent = "Revise Again";
        scoreTag.classList.add("tag-bad");
        medalHTML = "üôå No medal yet ‚Äì keep trying!";
        gameMessage.innerHTML = "üîÑ <strong>Don‚Äôt give up.</strong> Revise the concept and replay the quiz for a better score.";
      }

      medalBox.textContent = medalHTML;
      scoreBox.style.display = "inline-flex";

      updateGameStats(scoreRounded);
    }

    function resetQuiz() {
      const inputs = document.querySelectorAll('input[type="radio"]');
      inputs.forEach((input) => {
        input.checked = false;
        input.disabled = false;
      });

      clearFeedback();
      scoreBox.style.display = "none";
      gameMessage.textContent = "New round started. Try to beat your high score and win a better medal! üéÆ";
      answerKeyBox.style.display = "none";

      hasSubmittedOnce = false;
      toggleKeyBtn.disabled = true;
      quizEnded = false;
      submitBtn.disabled = false;

      startTimer();
    }

    function toggleAnswerKey() {
      if (!hasSubmittedOnce) {
        alert("You can see the answer key only after submitting your quiz.");
        return;
      }
      const isVisible = answerKeyBox.style.display === "block";
      answerKeyBox.style.display = isVisible ? "none" : "block";
    }

    submitBtn.addEventListener("click", () => gradeQuiz(false));
    resetBtn.addEventListener("click", resetQuiz);
    toggleKeyBtn.addEventListener("click", toggleAnswerKey);

    // Initialize
    loadGameStats();
    gameMessage.textContent = "Answer the questions within the time limit. Remember: +1 for correct, ‚àí0.25 for wrong. ‚è±";
    startTimer();
  </script>
</body>
</html>
